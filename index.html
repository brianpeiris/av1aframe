<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <title>AV1 - WebVR</title>
        <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
        <script src="https://cdn.rawgit.com/feiss/aframe-environment-component/fe9f9634256cf9eaba02dda0577d81fdb3b7b892/dist/aframe-environment-component.min.js"></script>
    </head>
    <body>
        <a-scene> 
            <a-assets>
                <a-cubemap id="sky">
                  <canvas id="mapright"></canvas>
                  <canvas id="mapleft"></canvas>
                  <canvas id="maptop"></canvas>
                  <canvas id="mapbottom"></canvas>
                  <canvas id="mapfront"></canvas>
                  <canvas id="mapback"></canvas>
                </a-cubemap>
            </a-assets>
            <a-entity environment="preset: forest"></a-entity>
            <a-gltf-model id="logo" src="av1.glb" material="envMap: #sky" position="-1 3.5 -3.00" rotation="90 0 0" scale="3 3 3" ></a-gltf-model>
            <a-video src="badapple.mp4" position="-1.5 1.5 -1.3" rotation="0 45 0"></a-video>
            <a-video src="badapple.mp4" position="1.5 1.5 -1.3002246314067976" rotation="0 -45 0"></a-video>
            <a-video src="badapple.mp4" position="0 1.5 -2.00"></a-video>
        </a-scene>
        <script>
            const canvases = [mapright, mapleft, maptop, mapbottom, mapfront, mapback];
            for (const map of canvases) {
                map.width = 50;
                map.height = 50;
                map.style.position = "absolute";
                map.style.top = 0;
                map.style.left = 0;
                const ctx = map.getContext("2d");
                ctx.fillStyle = "white";
                ctx.fillRect(0, 0, 50, 50);
            }
            logo.addEventListener("model-loaded", e => {
                const envmap = new THREE.CubeTexture(canvases);
                e.detail.model.traverse(obj => {
                    if (!obj.material) return;
                    obj.material.envMap = envmap;
                    obj.material.needsUpdate = true;
                });
            });
        </script>
    </body>
</html>
